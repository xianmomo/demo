<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sf.itmro.business.dao.SysResMapper">
	<resultMap id="BaseResultMap" type="com.sf.itmro.business.model.SysRes">
		<id column="res_id" property="resId" jdbcType="VARCHAR" />
		<result column="parent_id" property="parentId" jdbcType="VARCHAR" />
		<result column="res_name" property="resName" jdbcType="VARCHAR" />
		<result column="res_path" property="resPath" jdbcType="VARCHAR" />
		<result column="res_type" property="resType" jdbcType="VARCHAR" />
		<result column="res_statu" property="resStatu" jdbcType="VARCHAR" />
		<result column="level_path" property="levelPath" jdbcType="VARCHAR" />
		<result column="create_id" property="createId" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="modify_id" property="modifyId" jdbcType="VARCHAR" />
		<result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		res_id, parent_id, res_name, res_path, res_type,
		res_statu,level_path,
		create_id,
		create_time,
		modify_id, modify_time,
		remark
	</sql>

	<sql id="queryWhere">
		<where>
			and res_statu in ('0','1')
			<if test="resNameLike != null and resNameLike!=''">
				and res_name like '%${resName}%'
			</if>
			<if test="resName != null and resName!=''">
				and res_name = #{resName}
			</if>
			<if test="resId != null and resId !=''">
				and res_id = #{resId}
			</if>
			<if test="parentId != null and parentId !=''">
				and parent_id = #{parentId}
			</if>
			<if test="resType != null and resType !=''">
				and res_type = #{resType}
			</if>
			<if test="resStatu != null and resStatu !=''">
				and res_statu = #{resStatu}
			</if>
			<if test="resStatuIn != null and resStatuIn !='' ">
				and res_statu in ${resStatuIn}
			</if>
			<if test="userCode != null and userCode !='' ">
				and exists (select 1 from sys_user where sys_user.user_code=#{userCode} and (sys_user.is_admin ='99' or sys_user.is_admin ='0'))
			</if>
		</where>
	</sql>

	<select id="querySysResByMenu" resultMap="BaseResultMap"
		parameterType="map">
		select
		<include refid="Base_Column_List"></include>
		from sys_res
		<include refid="queryWhere"></include>
		order by create_time asc
	</select>

	<select id="querySysResData" resultType="map" parameterType="map">
		select
		res_id, parent_id as "_parentId", res_name, res_path, res_type,
		res_statu,
		level_path,
		create_id,
		date_format(create_time,'%Y-%m-%d
		%H:%i:%s') as
		create_time_str,
		modify_id, modify_time, remark,
		(select
		res_name from sys_res tt where tt.res_id = t.parent_id) as
		parent_name,
		(select user_alias from sys_user tt where tt.user_code =
		t.create_id) as create_name
		from sys_res t
		<include refid="queryWhere"></include>
	</select>
	
	<select id="querySelectData" resultMap="BaseResultMap">
		select * from sys_res t where t.parent_id='999999' and res_statu in ('0','1') and t.res_type='0'
	</select>

	<select id="queryData" resultMap="BaseResultMap" parameterType="map">
		select
		<include refid="Base_Column_List"></include>
		from sys_res
		<include refid="queryWhere"></include>
	</select>

	<insert id="insertSelective" parameterType="com.sf.itmro.business.model.SysRes">
		insert into sys_res
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="resId != null">
				res_id,
			</if>
			<if test="levelPath != null">
				level_path,
			</if>
			<if test="parentId != null">
				parent_id,
			</if>
			<if test="resName != null">
				res_name,
			</if>
			<if test="resPath != null">
				res_path,
			</if>
			<if test="resType != null">
				res_type,
			</if>
			<if test="resStatu != null">
				res_statu,
			</if>
			<if test="createId != null">
				create_id,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="modifyId != null">
				modify_id,
			</if>
			<if test="modifyTime != null">
				modify_time,
			</if>
			<if test="remark != null">
				remark,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="resId != null">
				#{resId,jdbcType=VARCHAR},
			</if>
			<if test="levelPath != null">
				#{levelPath,jdbcType=VARCHAR},
			</if>
			<if test="parentId != null">
				#{parentId,jdbcType=INTEGER},
			</if>
			<if test="resName != null">
				#{resName,jdbcType=VARCHAR},
			</if>
			<if test="resPath != null">
				#{resPath,jdbcType=VARCHAR},
			</if>
			<if test="resType != null">
				#{resType,jdbcType=VARCHAR},
			</if>
			<if test="resStatu != null">
				#{resStatu,jdbcType=VARCHAR},
			</if>
			<if test="createId != null">
				#{createId,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyId != null">
				#{modifyId,jdbcType=VARCHAR},
			</if>
			<if test="modifyTime != null">
				#{modifyTime,jdbcType=TIMESTAMP},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	
	<update id="updateByPrimaryKeySelective" parameterType="com.sf.itmro.business.model.SysRes">
		update sys_res
		<set>
			<if test="levelPath != null">
				level_path = #{levelPath,jdbcType=VARCHAR},
			</if>
			<if test="parentId != null">
				parent_id = #{parentId,jdbcType=VARCHAR},
			</if>
			<if test="resName != null">
				res_name = #{resName,jdbcType=VARCHAR},
			</if>
			<if test="resPath != null">
				res_path = #{resPath,jdbcType=VARCHAR},
			</if>
			<if test="resType != null">
				res_type = #{resType,jdbcType=VARCHAR},
			</if>
			<if test="resStatu != null">
				res_statu = #{resStatu,jdbcType=VARCHAR},
			</if>
			<if test="createId != null">
				create_id = #{createId,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyId != null">
				modify_id = #{modifyId,jdbcType=VARCHAR},
			</if>
			<if test="modifyTime != null">
				modify_time = #{modifyTime,jdbcType=TIMESTAMP},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
		</set>
		where res_id = #{resId,jdbcType=VARCHAR}
	</update>

	<delete id="deleteByLevelPath" parameterType="map">
		update sys_res t
		set res_statu = 2 where t.level_path like '${levelPath}%'
	</delete>

</mapper>